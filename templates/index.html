<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>WPS Tester Pro - GitHub Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #0f0f0f; color: #fff; font-family: sans-serif; }
        #terminal { background: #000; color: #0f0; height: 350px; overflow-y: auto; font-family: monospace; border: 1px solid #444; }
        .card { background: #1a1a1a; border: 1px solid #333; }
    </style>
</head>
<body class="p-4">
<div class="container">
    <h2 class="text-info mb-4 text-center">WPS WPA TESTER DASHBOARD</h2>
    
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card p-3 mb-3">
                <label>Pilih Interface:</label>
                <select id="ifaceSelect" class="form-select bg-dark text-white mt-1 mb-3"></select>
                <button onclick="startScan()" class="btn btn-primary w-100 mb-2">Scan WPS</button>
                <button onclick="stopProses()" class="btn btn-warning w-100">Stop Proses</button>
            </div>
            <div class="card p-3">
                <label>BSSID Target:</label>
                <input type="text" id="targetBssid" class="form-control bg-dark text-white mt-1 mb-3" placeholder="00:11:22:33:44:55">
                <button onclick="startAttack()" class="btn btn-danger w-100">Serangan Pixie-Dust</button>
            </div>
        </div>
        <div class="col-md-8">
            <div id="terminal" class="rounded p-3">--- Siap ---</div>
        </div>
    </div>

    <div class="card p-3">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4>Riwayat Password</h4>
            <a href="/export" class="btn btn-success btn-sm">Ekspor ke .TXT</a>
        </div>
        <table class="table table-dark table-hover">
            <thead><tr><th>SSID</th><th>BSSID</th><th>PIN</th><th>Password</th><th>Waktu</th></tr></thead>
            <tbody id="historyBody"></tbody>
        </table>
    </div>
</div>

<script>
    const socket = io();
    function startScan() { socket.emit('start_scan', {interface: document.getElementById('ifaceSelect').value}); }
    function startAttack() { 
        const bssid = document.getElementById('targetBssid').value;
        socket.emit('start_attack', {bssid: bssid, interface: document.getElementById('ifaceSelect').value}); 
    }
    function stopProses() { fetch('/stop').then(() => alert("Proses dihentikan")); }

    socket.on('terminal_output', (msg) => {
        const t = document.getElementById('terminal');
        t.innerText += msg.data;
        t.scrollTop = t.scrollHeight;
    });

    function loadHistory() {
        fetch('/history').then(r => r.json()).then(data => {
            document.getElementById('historyBody').innerHTML = data.map(r => `<tr><td>${r[1]}</td><td>${r[2]}</td><td class="text-warning">${r[3]}</td><td class="text-success">${r[4]}</td><td>${r[5]}</td></tr>`).join('');
        });
    }

    fetch('/get_interfaces').then(r => r.json()).then(data => {
        document.getElementById('ifaceSelect').innerHTML = data.map(i => `<option value="${i}">${i}</option>`).join('');
    });

    setInterval(loadHistory, 5000);
    window.onload = loadHistory;
</script>
</body>
    </html>
