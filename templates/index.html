<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WPS Tester Pro - Web Control</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #121212; color: #e0e0e0; }
        #terminal { background: #000; color: #00ff00; height: 400px; overflow-y: auto; font-family: monospace; padding: 10px; border: 1px solid #333; }
        .card { background: #1e1e1e; border: none; }
        .table { color: #fff; }
    </style>
</head>
<body>
<div class="container py-4">
    <h2 class="text-center mb-4 text-primary">WPS WPA Tester Console</h2>

    <div class="row g-3">
        <div class="col-md-4">
            <div class="card p-3">
                <h5>Kontrol Utama</h5>
                <button onclick="startScan()" class="btn btn-outline-info mb-2">Scan Jaringan (Wash)</button>
                <hr>
                <div class="mb-3">
                    <label>BSSID Target</label>
                    <input type="text" id="targetBssid" class="form-control bg-dark text-white border-secondary" placeholder="AA:BB:CC:DD:EE:FF">
                </div>
                <button onclick="startAttack()" class="btn btn-danger w-100">Mulai Serangan Pixie-Dust</button>
            </div>
        </div>

        <div class="col-md-8">
            <div id="terminal">--- Siap Menerima Perintah ---</div>
        </div>
    </div>

    <div class="mt-5 card p-3">
        <div class="d-flex justify-content-between">
            <h5>Riwayat Database (Cracked)</h5>
            <div>
                <button onclick="loadHistory()" class="btn btn-sm btn-success">Refresh</button>
                <button onclick="clearHistory()" class="btn btn-sm btn-outline-danger">Hapus Semua</button>
            </div>
        </div>
        <table class="table table-hover mt-3">
            <thead>
                <tr><th>SSID</th><th>BSSID</th><th>PIN</th><th>Password</th><th>Waktu</th></tr>
            </thead>
            <tbody id="historyBody"></tbody>
        </table>
    </div>
</div>

<script>
    const socket = io();
    const term = document.getElementById('terminal');

    socket.on('terminal_output', (msg) => {
        term.innerText += msg.data;
        term.scrollTop = term.scrollHeight;
    });

    function startScan() { term.innerText = ""; socket.emit('start_scan'); }
    
    function startAttack() {
        const bssid = document.getElementById('targetBssid').value;
        if(!bssid) return alert("BSSID Wajib Diisi!");
        socket.emit('start_attack', {bssid: bssid});
    }

    function loadHistory() {
        fetch('/history').then(res => res.json()).then(data => {
            const body = document.getElementById('historyBody');
            body.innerHTML = data.map(row => `
                <tr>
                    <td>${row[1]}</td><td>${row[2]}</td>
                    <td><b class="text-warning">${row[3]}</b></td>
                    <td><b class="text-success">${row[4]}</b></td>
                    <td style="font-size: 0.8em">${row[5]}</td>
                </tr>`).join('');
        });
    }

    function clearHistory() {
        if(confirm("Hapus semua riwayat?")) fetch('/clear_history').then(() => loadHistory());
    }

    window.onload = loadHistory;
</script>
</body>
                                                                                                        </html>
